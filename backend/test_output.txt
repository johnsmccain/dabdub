
> backend@0.0.1 test
> jest

[31m[Nest] 64279  - [39m01/29/2026, 4:34:23 PM [31m  ERROR[39m [38;5;3m[CacheService] [39m[31mCache get error for key test-key:[39m
[31m[Nest] 64279  - [39m01/29/2026, 4:34:23 PM [31m  ERROR[39m [38;5;3m[CacheService] [39mError: Redis error
    at Object.<anonymous> [90m(/Users/macbookpro/Desktop/dab/backend/[39msrc/cache/cache.service.spec.ts:62:46[90m)[39m
    at Promise.finally.completed [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1557:28[90m)[39m
    at new Promise (<anonymous>)
    at callAsyncCircusFn [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1497:10[90m)[39m
    at _callCircusTest [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1007:40[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at _runTest [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:947:3[90m)[39m
    at [90m/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:849:7
    at _runTestsForDescribeBlock [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:862:11[90m)[39m
    at _runTestsForDescribeBlock [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:857:11[90m)[39m
    at _runTestsForDescribeBlock [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:857:11[90m)[39m
    at run [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:761:3[90m)[39m
    at runAndTransformResultsToJestFormat [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1918:21[90m)[39m
    at jestAdapter [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/runner.js:101:19[90m)[39m
    at runTestInternal [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:275:16[90m)[39m
    at runTest [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:343:7[90m)[39m
    at Object.worker [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:497:12[90m)[39m
[31m[Nest] 64279  - [39m01/29/2026, 4:34:23 PM [31m  ERROR[39m [38;5;3m[CacheService] [39m[31mCache set error for key test-key:[39m
[31m[Nest] 64279  - [39m01/29/2026, 4:34:23 PM [31m  ERROR[39m [38;5;3m[CacheService] [39mError: Redis error
    at Object.<anonymous> [90m(/Users/macbookpro/Desktop/dab/backend/[39msrc/cache/cache.service.spec.ts:88:46[90m)[39m
    at Promise.finally.completed [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1557:28[90m)[39m
    at new Promise (<anonymous>)
    at callAsyncCircusFn [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1497:10[90m)[39m
    at _callCircusTest [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1007:40[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at _runTest [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:947:3[90m)[39m
    at [90m/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:849:7
    at _runTestsForDescribeBlock [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:862:11[90m)[39m
    at _runTestsForDescribeBlock [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:857:11[90m)[39m
    at _runTestsForDescribeBlock [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:857:11[90m)[39m
    at run [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:761:3[90m)[39m
    at runAndTransformResultsToJestFormat [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/jestAdapterInit.js:1918:21[90m)[39m
    at jestAdapter [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-circus[24m/build/runner.js:101:19[90m)[39m
    at runTestInternal [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:275:16[90m)[39m
    at runTest [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:343:7[90m)[39m
    at Object.worker [90m(/Users/macbookpro/Desktop/dab/backend/[39mnode_modules/[4mjest-runner[24m/build/testWorker.js:497:12[90m)[39m
PASS src/cache/cache.service.spec.ts (17.641 s)
FAIL src/config/global-config.service.spec.ts (17.629 s)
  ‚óè GlobalConfigService ‚Ä∫ App Configuration ‚Ä∫ should return node environment

    expect(received).toContain(expected) // indexOf

    Expected value: "test"
    Received array: ["development", "staging", "production"]

      24 |       const env = service.getNodeEnv();
      25 |       expect(env).toBeDefined();
    > 26 |       expect(['development', 'staging', 'production']).toContain(env);
         |                                                        ^
      27 |     });
      28 |
      29 |     it('should return port number', () => {

      at Object.<anonymous> (src/config/global-config.service.spec.ts:26:56)

  ‚óè GlobalConfigService ‚Ä∫ App Configuration ‚Ä∫ should identify development environment

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      35 |     it('should identify development environment', () => {
      36 |       // Default environment is development
    > 37 |       expect(service.isDevelopment()).toBe(true);
         |                                       ^
      38 |     });
      39 |
      40 |     it('should identify debug mode', () => {

      at Object.<anonymous> (src/config/global-config.service.spec.ts:37:39)

  ‚óè GlobalConfigService ‚Ä∫ Cache Management ‚Ä∫ should clear cache

    expect(received).not.toBe(expected) // Object.is equality

    Expected: not {"database": "dabdub_dev", "host": "localhost", "logging": false, "password": "", "poolSize": 10, "port": 5432, "synchronize": false, "username": "postgres"}

      112 |       const config2 = service.getDatabaseConfig();
      113 |       // Different object references after cache clear
    > 114 |       expect(config1).not.toBe(config2);
          |                           ^
      115 |     });
      116 |   });
      117 | });

      at Object.<anonymous> (src/config/global-config.service.spec.ts:114:27)

PASS src/blockchain/services/blockchain-monitoring.service.spec.ts (17.879 s)
FAIL src/app.controller.spec.ts (18.009 s)
  ‚óè AppController ‚Ä∫ root ‚Ä∫ should return "Hello World!"

    Nest can't resolve dependencies of the AppController (AppService, ?). Please make sure that the argument DatabaseHealthIndicator at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If DatabaseHealthIndicator is a provider, is it part of the current RootTestModule?
    - If DatabaseHealthIndicator is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing DatabaseHealthIndicator */ ]
      })

    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors

       7 |
       8 |   beforeEach(async () => {
    >  9 |     const app: TestingModule = await Test.createTestingModule({
         |                                ^
      10 |       controllers: [AppController],
      11 |       providers: [AppService],
      12 |     }).compile();

      at TestingInjector.lookupComponentInParentModules (node_modules/@nestjs/core/injector/injector.js:290:19)
      at TestingInjector.resolveComponentWrapper (node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (node_modules/@nestjs/core/injector/injector.js:140:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (node_modules/@nestjs/core/injector/injector.js:169:27)
      at TestingInjector.loadInstance (node_modules/@nestjs/core/injector/injector.js:75:13)
      at TestingInjector.loadController (node_modules/@nestjs/core/injector/injector.js:94:9)
      at node_modules/@nestjs/core/injector/instance-loader.js:68:13
          at async Promise.all (index 0)
      at TestingInstanceLoader.createInstancesOfControllers (node_modules/@nestjs/core/injector/instance-loader.js:67:9)
      at node_modules/@nestjs/core/injector/instance-loader.js:42:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (src/app.controller.spec.ts:9:32)

PASS src/payment-request/payment-request.service.spec.ts (18.231 s)
PASS src/settlement/settlement.service.spec.ts (18.265 s)
PASS src/settlement/entities/settlement.entity.spec.ts
PASS src/payment-request/services/expiration-scheduler.service.spec.ts (18.513 s)
PASS src/payment-request/repositories/payment-request.repository.spec.ts (18.497 s)
PASS src/webhook/services/webhook-delivery-log-maintenance.service.spec.ts
PASS src/webhook/services/webhook-delivery.service.spec.ts (18.711 s)
PASS src/analytics/analytics.controller.spec.ts (18.688 s)
PASS src/analytics/analytics.service.spec.ts
PASS test/health.spec.ts
FAIL src/settlement/repositories/settlement.repository.spec.ts
  ‚óè Test suite failed to run

    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m26[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'string'.

    [7m26[0m     bankSwiftCode: null,
    [7m  [0m [91m    ~~~~~~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m92[0m:[93m3[0m
        [7m92[0m   bankSwiftCode!: string;
        [7m  [0m [96m  ~~~~~~~~~~~~~[0m
        The expected type comes from property 'bankSwiftCode' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m27[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'string'.

    [7m27[0m     bankIban: null,
    [7m  [0m [91m    ~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m95[0m:[93m3[0m
        [7m95[0m   bankIban!: string;
        [7m  [0m [96m  ~~~~~~~~[0m
        The expected type comes from property 'bankIban' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m28[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'string'.

    [7m28[0m     batchId: null,
    [7m  [0m [91m    ~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m99[0m:[93m3[0m
        [7m99[0m   batchId!: string;
        [7m  [0m [96m  ~~~~~~~[0m
        The expected type comes from property 'batchId' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m29[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'number'.

    [7m29[0m     batchSequence: null,
    [7m  [0m [91m    ~~~~~~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m102[0m:[93m3[0m
        [7m102[0m   batchSequence!: number;
        [7m   [0m [96m  ~~~~~~~~~~~~~[0m
        The expected type comes from property 'batchSequence' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m36[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'string'.

    [7m36[0m     providerReference: null,
    [7m  [0m [91m    ~~~~~~~~~~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m158[0m:[93m3[0m
        [7m158[0m   providerReference!: string;
        [7m   [0m [96m  ~~~~~~~~~~~~~~~~~[0m
        The expected type comes from property 'providerReference' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m37[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'string'.

    [7m37[0m     settlementReceipt: null,
    [7m  [0m [91m    ~~~~~~~~~~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m168[0m:[93m3[0m
        [7m168[0m   settlementReceipt!: string;
        [7m   [0m [96m  ~~~~~~~~~~~~~~~~~[0m
        The expected type comes from property 'settlementReceipt' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m38[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'string'.

    [7m38[0m     settlementReference: null,
    [7m  [0m [91m    ~~~~~~~~~~~~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m176[0m:[93m3[0m
        [7m176[0m   settlementReference!: string;
        [7m   [0m [96m  ~~~~~~~~~~~~~~~~~~~[0m
        The expected type comes from property 'settlementReference' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m39[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'string'.

    [7m39[0m     failureReason: null,
    [7m  [0m [91m    ~~~~~~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m180[0m:[93m3[0m
        [7m180[0m   failureReason!: string;
        [7m   [0m [96m  ~~~~~~~~~~~~~[0m
        The expected type comes from property 'failureReason' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m42[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'Date'.

    [7m42[0m     settledAt: null,
    [7m  [0m [91m    ~~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m190[0m:[93m3[0m
        [7m190[0m   settledAt!: Date;
        [7m   [0m [96m  ~~~~~~~~~[0m
        The expected type comes from property 'settledAt' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m43[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'Date'.

    [7m43[0m     processedAt: null,
    [7m  [0m [91m    ~~~~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m193[0m:[93m3[0m
        [7m193[0m   processedAt!: Date;
        [7m   [0m [96m  ~~~~~~~~~~~[0m
        The expected type comes from property 'processedAt' which is declared here on type 'Settlement'
    [96msrc/settlement/repositories/settlement.repository.spec.ts[0m:[93m46[0m:[93m5[0m - [91merror[0m[90m TS2322: [0mType 'null' is not assignable to type 'Record<string, any>'.

    [7m46[0m     metadata: null,
    [7m  [0m [91m    ~~~~~~~~[0m

      [96msrc/settlement/entities/settlement.entity.ts[0m:[93m203[0m:[93m3[0m
        [7m203[0m   metadata!: Record<string, any>;
        [7m   [0m [96m  ~~~~~~~~[0m
        The expected type comes from property 'metadata' which is declared here on type 'Settlement'

FAIL src/common/errors/error-handling.spec.ts
  ‚óè Test suite failed to run

    [96msrc/common/errors/error-handling.spec.ts[0m:[93m7[0m:[93m3[0m - [91merror[0m[90m TS2305: [0mModule '"./exceptions/http-exceptions"' has no exported member 'InsufficientFundsException'.

    [7m7[0m   InsufficientFundsException,
    [7m [0m [91m  ~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/common/errors/error-handling.spec.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2724: [0m'"./exceptions/http-exceptions"' has no exported member named 'WalletNotFoundException'. Did you mean 'NotFoundException'?

    [7m8[0m   WalletNotFoundException,
    [7m [0m [91m  ~~~~~~~~~~~~~~~~~~~~~~~[0m

      [96msrc/common/errors/exceptions/http-exceptions.ts[0m:[93m89[0m:[93m14[0m
        [7m89[0m export class NotFoundException extends BaseHttpException {
        [7m  [0m [96m             ~~~~~~~~~~~~~~~~~[0m
        'NotFoundException' is declared here.
    [96msrc/common/errors/error-handling.spec.ts[0m:[93m90[0m:[93m49[0m - [91merror[0m[90m TS2345: [0mArgument of type '({ field: string; message: string; rejectedValue: string; constraints: { isEmail: string; minLength?: undefined; }; } | { field: string; message: string; rejectedValue: string; constraints: { minLength: string; isEmail?: undefined; }; })[]' is not assignable to parameter of type 'ValidationError[]'.
      Type '{ field: string; message: string; rejectedValue: string; constraints: { isEmail: string; minLength?: undefined; }; } | { field: string; message: string; rejectedValue: string; constraints: { minLength: string; isEmail?: undefined; }; }' is not assignable to type 'ValidationError'.
        Type '{ field: string; message: string; rejectedValue: string; constraints: { isEmail: string; minLength?: undefined; }; }' is not assignable to type 'ValidationError'.
          Types of property 'constraints' are incompatible.
            Type '{ isEmail: string; minLength?: undefined; }' is not assignable to type 'Record<string, string>'.
              Property 'minLength' is incompatible with index signature.
                Type 'undefined' is not assignable to type 'string'.

    [7m90[0m       const exception = new ValidationException(validationErrors);
    [7m  [0m [91m                                                ~~~~~~~~~~~~~~~~[0m

PASS src/evm/evm.service.spec.ts
PASS src/payment-request/services/qr-code.service.spec.ts

Test Suites: 4 failed, 14 passed, 18 total
Tests:       4 failed, 98 passed, 102 total
Snapshots:   0 total
Time:        20.106 s, estimated 23 s
Ran all test suites.
